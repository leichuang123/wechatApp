<import src="../../../common/templates/loading" />
<import src="../../../common/templates/top-tips.wxml" />
<view wx:if="{{!loading}}">
    <template is="top-tips" data="{{showTopTips,errorMsg}}"></template>
    <!-- 客户填写资料 -->
    <view class="weui-cell_form weui-cells_after-title form-items">
        <view class="weui-cell weui-cell_select" wx:if="{{businessForm.need_car_number==='Y'}}">
            <view class="weui-cell__hd weui-cell__hd_in-select-after">
                <view class="weui-label">
                    <text class="fc-red">*</text>车牌号</view>
            </view>
            <view class="weui-cell__bd">
                <picker bindchange="carNumberChange" data-index="{{index}}" value="{{carIndex}}" range="{{carNumbers}}">
                    <view class="weui-select weui-select_in-select-after text-right">{{carNumbers[carIndex]}}</view>
                </picker>
            </view>
        </view>
        <view class="weui-cell">
            <view class="weui-cell__hd">
                <view class="weui-label">
                    <text class="fc-red">*</text>联系人</view>
            </view>
            <view class="weui-cell__bd weui-cell__ft text-black">
                <input placeholder="" data-item="contact" value="{{form.contact}}" bindblur="bindInput" />
            </view>
        </view>
        <view class="weui-cell">
            <view class="weui-cell__hd">
                <view class="weui-label">
                    <text class="fc-red">*</text>手机号</view>
            </view>
            <view class="weui-cell__bd weui-cell__ft text-black">
                <input type="number" placeholder="" value="{{form.mobile}}" data-item="mobile" bindblur="bindInput" />
            </view>
        </view>
    </view>
    <view class="weui-cell_form weui-cells_after-title form-items">
        <block wx:for="{{businessForm.customer_form}}" wx:key="index">
            <!-- 单选项-->
            <view class="weui-cell weui-cell_select" wx:if="{{item.type==formTypes.RADIO}}">
                <view class="weui-cell__hd weui-cell__hd_in-select-after">
                    <view class="weui-label">
                        <text class="fc-red">*</text>{{item.name}}</view>
                </view>
                <view class="weui-cell__bd">
                    <picker bindchange="customerFormOptionChange" data-index="{{index}}" value="{{customerForm[index].checkedIndex}}" range="{{item.options}}">
                        <view class="weui-select weui-select_in-select-after text-right">{{item.options[customerForm[index].checkedIndex]}}</view>
                    </picker>
                </view>
            </view>
            <!-- 单行文本输入 -->
            <view class="weui-cell" wx:if="{{item.type==formTypes.TEXT}}">
                <view class="weui-cell__hd">
                    <view class="weui-label">
                        <text class="fc-red">*</text>{{item.name}}</view>
                </view>
                <view class="weui-cell__bd weui-cell__ft text-black">
                    <input data-index="{{index}}" data-type="{{item.type}}" placeholder="" bindinput="customerFormInput" />
                </view>
            </view>
            <!-- 多行文本输入 -->
            <view class="weui-cells__title notice-title" wx:if="{{item.type==formTypes.TEXTAREA}}">{{item.name}}</view>
            <view class="weui-cell_form weui-cells_after-title" wx:if="{{item.type==formTypes.TEXTAREA}}">
                <view class=" weui-cell">
                    <view class="weui-cell__bd text-black">
                        <textarea class="weui-textarea" style="height: 3.3em" placeholder="请输入{{item.name}}" data-index="{{index}}" data-type="{{item.type}}" bindinput="customerFormInput" />
                        <view class="weui-textarea-counter">0/200</view>
                    </view>
                </view>
            </view>
            <!-- 数字 -->
            <view class="weui-cell weui-cell_input" wx:if="{{item.type==formTypes.NUMBER}}">
                <view class="weui-cell__hd">
                    <view class="weui-label">
                        <text class="fc-red">*</text>{{item.name}}</view>
                </view>
                <view class="weui-cell__bd weui-cell__ft text-black">
                    <input type="number" placeholder="" data-index="{{index}}" bindinput="customerFormInput" />
                </view>
            </view>
            <!-- 日期 -->
            <view class="weui-cell weui-cell_select" wx:if="{{item.type==formTypes.DATE}}">
                <view class="weui-cell__hd weui-cell__hd_in-select-after">
                    <view class="weui-label">
                        <text class="fc-red">*</text>{{item.name}}</view>
                </view>
                <view class="weui-cell__bd">
                    <picker mode="date" value="{{customerForm[index].value}}" start="1970-01-01" end="{{today}}" data-item="{{item}}" bindchange="customerFormDateChange" data-index="{{index}}">
                        <view class="weui-select weui-select_in-select-after text-right">{{customerForm[index].value}}</view>
                    </picker>
                </view>
            </view>
        </block>
    </view>
    <!-- 业务属性 -->
    <view class="weui-cell_form weui-cells_after-title form-items" wx:if="{{businessForm.attribute.length>0}}">
        <block wx:for="{{businessForm.attribute}}" wx:key="index">
            <!-- 属性选项为2 -->
            <view class="weui-cell" wx:if="{{item.children.length<=2}}">
                <view class="weui-cell__bd">
                    <text class="fc-red">*</text>{{item.name}}</view>
                <view class="weui-cell__ft">
                    <radio-group bindchange="attributeChange" data-index="{{index}}" class="weui-flex">
                        <label class="weui-flex weui-flex__item weui-check__label" wx:for="{{item.children}}" wx:for-item="it" wx:for-index="idx" wx:key="id">
                            <radio class="weui-check" value="{{idx}}" checked="{{it.checked}}" />
                            <view class="weui-cell__hd weui-check__hd_in-checkbox">
                                <icon class="weui-icon-checkbox_circle" type="circle" size="23" wx:if="{{!it.checked}}"></icon>
                                <icon class="weui-icon-checkbox_success" type="success" size="23" wx:if="{{it.checked}}"></icon>
                            </view>
                            <view class="weui-cell__bd">{{it.name}}</view>
                        </label>
                    </radio-group>
                </view>
            </view>
            <!-- 属性选项多余2 -->
            <view class="weui-cell weui-cell_select" wx:if="{{item.children.length>2}}">
                <view class="weui-cell__hd weui-cell__hd_in-select-after">
                    <view class="weui-label">
                        <text class="fc-red">*</text>{{item.name}}</view>
                </view>
                <view class="weui-cell__bd">
                    <picker bindchange="changeCarNumber" value="0" range="{{item.children}}">
                        <view class="weui-select weui-select_in-select-after text-right">{{item.children[index].name}}</view>
                    </picker>
                </view>
            </view>
        </block>
    </view>
    <!-- 取件和邮寄选项 -->
    <view class="weui-cell_form weui-cells_after-title form-items">
        <view class="weui-cell" wx:if="{{businessForm.is_send_home==='Y'}}">
            <view class="weui-cell__bd">上门取件（取件费用{{businessForm.send_home_money}}元）</view>
            <view class="weui-cell__ft">
                <switch data-type="take" checked="{{takeChecked}}" bindchange="switchChange" />
            </view>
        </view>
        <view class="weui-cell" wx:if="{{businessForm.support_data_post==='Y'}}">
            <view class="weui-cell__bd">办理资料是否选择邮寄</view>
            <view class="weui-cell__ft">
                <switch data-type="post" checked="{{postChecked}}" bindchange="switchChange" />
            </view>
        </view>
    </view>
    <view class="weui-cell_form weui-cells_after-title form-items">
        <!-- 个人需要上传资料 -->
        <view wx:if="{{form.user_type==1}}">
            <block wx:for="{{businessForm.need_upload.personal}}" wx:key="index">
                <view class="weui-cell">
                    <view class="weui-cell__bd">
                        <view class="weui-uploader">
                            <view class="weui-uploader__hd">
                                <view class="weui-uploader__title">
                                    <text class="fc-red">*</text>上传{{item.name}}</view>
                                <view class="weui-uploader__info">{{personImageList[index].length}}/2</view>
                            </view>
                            <view class="weui-uploader__bd">
                                <view class="weui-uploader__files">
                                    <block wx:for="{{personImageList[index]}}" wx:for-index="idx" wx:for-item="image" wx:key="idx">
                                        <view class="weui-uploader__file weui-uploader__file_status" data-src="{{image}}" data-index="{{index}}" bindtap="previewImage">
                                            <image class="weui-uploader__img" src="{{image}}" mode="aspectFill" />
                                            <view class="weui-uploader__image" data-index="{{idx}}" data-pindex="{{index}}" catchtap='deleteImage'>
                                                <icon type="cancel" size="16" color="#F43530" class="weui-uploader__icon--cancel"></icon>
                                            </view>
                                        </view>
                                    </block>
                                </view>
                                <view class="weui-uploader__input-box">
                                    <view class="weui-uploader__input" data-index="{{index}}" bindtap="chooseImages"></view>
                                </view>
                            </view>
                        </view>
                    </view>
                </view>
            </block>
        </view>
        <!-- 企业需要上传资料 -->
        <view wx:if="{{form.user_type==2}}">
            <block wx:for="{{businessForm.need_upload.crop}}" wx:key="index">
                <view class="weui-cell">
                    <view class="weui-cell__bd">
                        <view class="weui-uploader">
                            <view class="weui-uploader__hd">
                                <view class="weui-uploader__title">
                                    <text class="fc-red">*</text>上传{{item.name}}</view>
                                <view class="weui-uploader__info">{{cropImageList[index].length}}/2</view>
                            </view>
                            <view class="weui-uploader__bd">
                                <view class="weui-uploader__files">
                                    <block wx:for="{{cropImageList[index]}}" wx:for-index="idx" wx:for-item="image" wx:key="idx">
                                        <view class="weui-uploader__file  weui-uploader__file_status" data-index="{{index}}" data-src="{{image}}" bindtap="previewImage">
                                            <image class="weui-uploader__img" src="{{image}}" mode="aspectFill" />
                                            <view class="weui-uploader__image" data-index="{{idx}}" data-pindex="{{index}}" catchtap='deleteImage'>
                                                <icon type="cancel" size="16" color="#F43530" class="weui-uploader__icon--cancel"></icon>
                                            </view>
                                        </view>
                                    </block>
                                </view>
                                <view class="weui-uploader__input-box">
                                    <view class="weui-uploader__input" data-index="{{index}}" bindtap="chooseImages"></view>
                                </view>
                            </view>
                        </view>
                    </view>
                </view>
            </block>
        </view>
        <view class="weui-cells__title notice-title">备注</view>
        <view class="weui-cell_form weui-cells_after-title">
            <view class="weui-cell">
                <view class="weui-cell__bd">
                    <textarea style="height: 3.3em" placeholder="请输入备注" data-item="notice" bindinput="bindInput" />
                    <view class="weui-textarea-counter">{{noticeLength}}/200</view>
                </view>
            </view>
        </view>
    </view>
    <view class='weui-flex'>
        <view class="weui-flex__item btn-padding">
            <button class="weui-btn mini-btn" type="default" bindtap="goBack">取消</button>
        </view>
        <view class="weui-flex__item btn-padding">
            <button class="weui-btn mini-btn" type="primary" bindtap="onFormSubmit">确认</button>
        </view>
    </view>
</view>
<loading wx:if="{{loading}}">加载中</loading>